<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rosas Eternas ‚ù§Ô∏è</title>

<style>
body{
    margin:0;
    overflow:hidden;
    background:black;
}

canvas{
    display:block;
}

#modal{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,0.95);
    display:none;
    justify-content:center;
    align-items:center;
    flex-direction:column;
    z-index:10;
}

#modal video{
    width:90%;
    border-radius:20px;
}
</style>
</head>
<body>

<!-- üéµ M√öSICA -->
<audio id="musica" src="musica.mp3" loop></audio>

<!-- üé¨ VIDEO DE LA FLOR CENTRAL -->
<div id="modal">
    <video id="videoFlor" controls playsinline>
        <source src="videoFlor.mp4" type="video/mp4">
    </video>
</div>

<script src="https://cdn.jsdelivr.net/npm/three@0.158.0/build/three.min.js"></script>

<script>

// ================= M√öSICA AUTOM√ÅTICA =================
const musica = document.getElementById("musica");

function iniciarMusica(){
    musica.volume = 0.7;
    musica.play().catch(()=>{});
}

// Intentar reproducir al cargar
window.addEventListener("load", iniciarMusica);

// Si el navegador bloquea autoplay, se activa en el primer toque
window.addEventListener("click", ()=>{
    if(musica.paused){
        musica.play().catch(()=>{});
    }
}, { once:true });


// ================= VIDEO DE FONDO (ATARDECER) =================
const videoFondo = document.createElement('video');
videoFondo.src = "atardecer.mp4";
videoFondo.loop = true;
videoFondo.muted = true;
videoFondo.play();

const texturaFondo = new THREE.VideoTexture(videoFondo);

// ================= ESCENA =================
const scene = new THREE.Scene();
scene.background = texturaFondo;

const camera = new THREE.PerspectiveCamera(60, window.innerWidth/window.innerHeight,0.1,1000);
camera.position.z = 35;

const renderer = new THREE.WebGLRenderer({antialias:true});
renderer.setSize(window.innerWidth, window.innerHeight);
document.body.appendChild(renderer.domElement);

// ================= LUCES =================
scene.add(new THREE.AmbientLight(0xffffff,0.6));

const light = new THREE.PointLight(0xffffff,1.5);
light.position.set(0,20,20);
scene.add(light);

// ================= CREAR ROSA DETALLADA =================
function crearRosa(color, brillo=false){

    const group = new THREE.Group();

    const material = new THREE.MeshPhysicalMaterial({
        color:color,
        roughness:0.25,
        metalness:0.5,
        clearcoat:1,
        emissive: brillo ? 0xffd700 : 0x000000,
        emissiveIntensity: brillo ? 2 : 0
    });

    const centro = new THREE.Mesh(
        new THREE.SphereGeometry(1.2,32,32),
        material
    );
    group.add(centro);

    for(let i=0;i<20;i++){
        const petalo = new THREE.Mesh(
            new THREE.SphereGeometry(2,32,32,0,Math.PI*2,0,Math.PI/2),
            material
        );
        petalo.scale.set(1.6,0.35,1.6);
        petalo.rotation.y = (i/20)*Math.PI*2;
        petalo.position.x = Math.sin(petalo.rotation.y)*1.4;
        petalo.position.z = Math.cos(petalo.rotation.y)*1.4;
        petalo.position.y = 0.4;
        group.add(petalo);
    }

    return group;
}

// ================= CREAR 10 FLORES =================
let rosas = [];

for(let i=0;i<10;i++){

    let esCentral = (i===0);

    let rosa = crearRosa(
        esCentral ? 0xffd700 : 0xff1744,
        esCentral
    );

    if(esCentral){
        rosa.position.set(0,0,0);
    }else{
        let angulo = (i/9)*Math.PI*2;
        rosa.position.x = Math.sin(angulo)*12;
        rosa.position.z = Math.cos(angulo)*12;
    }

    rosa.userData = {video: esCentral};
    scene.add(rosa);
    rosas.push(rosa);
}

// ================= INTERACCI√ìN =================
const raycaster = new THREE.Raycaster();
const mouse = new THREE.Vector2();

window.addEventListener("click", e=>{

    mouse.x = (e.clientX/window.innerWidth)*2-1;
    mouse.y = -(e.clientY/window.innerHeight)*2+1;

    raycaster.setFromCamera(mouse,camera);
    const intersects = raycaster.intersectObjects(rosas,true);

    if(intersects.length>0){

        let obj = intersects[0].object;

        while(obj.parent && obj.userData.video===undefined){
            obj = obj.parent;
        }

        if(obj.userData.video){
            const modal = document.getElementById("modal");
            const video = document.getElementById("videoFlor");
            modal.style.display="flex";
            video.play();
        }
    }
});

document.getElementById("modal").addEventListener("click", e=>{
    if(e.target.id==="modal"){
        const modal = document.getElementById("modal");
        const video = document.getElementById("videoFlor");
        modal.style.display="none";
        video.pause();
        video.currentTime = 0;
    }
});

// ================= ANIMACI√ìN =================
function animate(){
    requestAnimationFrame(animate);

    rosas.forEach(r=>{
        r.rotation.y += 0.01;
    });

    renderer.render(scene,camera);
}
animate();

// ================= RESPONSIVE =================
window.addEventListener("resize",()=>{
    camera.aspect = window.innerWidth/window.innerHeight;
    camera.updateProjectionMatrix();
    renderer.setSize(window.innerWidth,window.innerHeight);
});

</script>
</body>
</html>